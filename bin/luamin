#!/usr/bin/env node
(function() {

	var fs = require('fs');
	var luamin = require('../luamin.js');
	var minify = luamin.minify;
	var snippets = process.argv.splice(2);
	var firstSnippet = snippets[0];
	var isFile;

	if (!snippets.length || /^(?:-h|--help)$/.test(firstSnippet)) {
		console.log('luamin v%s - http://mths.be/luamin', luamin.version);
		console.log('\nUsage:');
		console.log('\tluamin [-c | --code] [snippet ...]');
		console.log('\tluamin [-f | --file] [file ...]');
		console.log('\tluamin [-v | --version]');
		console.log('\tluamin [-h | --help]');
		console.log('\nExamples:');
		console.log('\tluamin -c \'a = ((1 + 2) - 3) * (4 / (5 ^ 6))\'');
		console.log('\tluamin -f foo.lua');
		return process.exit(1);
	}

	if (/^(?:-v|--version)$/.test(firstSnippet)) {
		console.log('v%s', luamin.version);
		return process.exit(1);
	}

	if (/^(?:-f|--file)$/.test(firstSnippet)) {
		isFile = true;
	} else if (!/^(?:-c|--code)$/.test(firstSnippet)) {
		console.log('Unrecognized option `%s`.', firstSnippet);
		console.log('Try `luamin --help` for more information.');
		return process.exit(1);
	}

	snippets.shift();

	snippets.forEach(function(snippet) {
		if (isFile) {
			snippet = fs.readFileSync(snippet, 'utf-8');
		}
		var result = minify(snippet);
		console.log(result);
	});

}());
